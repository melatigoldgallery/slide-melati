<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Dashboard - Sistem Pencatatan Barang</title>

    <?!= include('style'); ?>
  </head>
  <body>
    <div class="header bg-primary">
      <div class="container">
        <h1>ðŸ“¦ Pengambilan Barang Melati Young</h1>
        <div>
          <button class="btn btn-success" onclick="openFormTambah()">âž• Tambah Data Baru</button>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="card p-3">
        <div class="d-flex align-items-center mb-3">
          <i class="bi bi-funnel fs-6 me-2"></i>
          <h5 class="mb-0">Filter & Pencarian Data</h5>
        </div>
        <div class="row g-3">
          <div class="col-md-3">
            <label for="filterSales" class="form-label">
              <i class="bi bi-person-badge"></i>
              Sales
            </label>
            <select id="filterSales" class="form-select p-1" onchange="applyFilters()">
              <option value="Semua">Semua Sales</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="filterPhoto" class="form-label">
              <i class="bi bi-image"></i>
              Status Foto
            </label>
            <select id="filterPhoto" class="form-select p-1" onchange="applyFilters()">
              <option value="all">Semua Status</option>
              <option value="yes">âœ“ Sudah Upload</option>
              <option value="no">âœ— Belum Upload</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="searchInput" class="form-label">
              <i class="bi bi-search"></i>
              Pencarian
            </label>
            <input
              type="text"
              id="searchInput"
              class="form-control p-1"
              placeholder="Cari berdasarkan Sales, Barang, Customer..."
              onkeyup="handleSearch()"
            />
          </div>
          <div class="col-md-1 d-flex align-items-end">
            <button class="btn btn-secondary w-100 p-2" onclick="resetFilters()" title="Reset Filter">
              <i class="bi bi-arrow-counterclockwise"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-label">Total Data</div>
          <div class="stat-value" id="statTotal">-</div>
        </div>
        <div class="stat-card stat-success">
          <div class="stat-label">Sudah Upload Foto</div>
          <div class="stat-value" id="statUploaded">-</div>
        </div>
        <div class="stat-card stat-danger">
          <div class="stat-label">Belum Upload Foto</div>
          <div class="stat-value" id="statNotUploaded">-</div>
        </div>
      </div>

      <div id="loadingContainer" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Memuat data...</p>
      </div>

      <div class="card" id="tableContainer" style="display: none">
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th>No</th>
                <th>Tanggal</th>
                <th>Jam</th>
                <th>Sales</th>
                <th>Customer</th>
                <th>Kontak</th>
                <th>Nama Barang</th>
                <th>Berat</th>
                <th>Kadar</th>
                <th>Harga</th>
                <th>Bukti Foto</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
        <div class="pagination" id="paginationContainer"></div>
      </div>

      <div id="emptyState" class="empty-state" style="display: none">
        <p>ðŸ“­ Tidak ada data yang ditemukan</p>
      </div>
    </div>

    <!-- ========================================== 
         BOOTSTRAP MODALS
         ========================================== -->

    <!-- Modal Upload Foto -->
    <div class="modal fade" id="modalUpload" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-cloud-upload"></i>
              Upload Foto
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="modalRecordInfo" class="record-info"></div>
            <div class="mb-3">
              <label class="form-label required">Pilih Foto</label>
              <input
                type="file"
                class="form-control"
                id="fileInput"
                accept="image/jpeg,image/jpg,image/png"
                onchange="previewImage(event)"
              />
              <small class="text-muted">Format: JPG/PNG | Maksimal: 5MB</small>
            </div>
            <div id="previewContainer" class="preview-container" style="display: none">
              <img id="previewImage" alt="Preview" class="img-fluid" />
            </div>
            <div id="uploadProgress" class="upload-progress" style="display: none">
              <div class="progress">
                <div id="progressBarFill" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
              </div>
              <p id="progressText" class="text-center mt-2">Mengupload...</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="button" class="btn btn-primary" id="btnUpload" onclick="handleUpload()" disabled>
              <i class="bi bi-check-circle"></i>
              Upload
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Tambah Data -->
    <div class="modal fade" id="modalTambah" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-plus-circle"></i>
              Tambah Data Baru
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="formTambah">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label required">Tanggal</label>
                  <input type="date" class="form-control" id="tanggal" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Jam</label>
                  <input type="time" class="form-control" id="jam" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Sales</label>
                  <input type="text" class="form-control" id="sales" required placeholder="Nama sales" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Nama Customer</label>
                  <input type="text" class="form-control" id="namaCustomer" placeholder="Nama customer" />
                </div>
                <div class="col-12">
                  <label class="form-label">Info Kontak</label>
                  <input type="text" class="form-control" id="infoKontak" placeholder="No. HP / Akun Shopee / IG" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Nama Barang</label>
                  <input type="text" class="form-control" id="namaBarang" required placeholder="Nama barang" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Berat</label>
                  <input type="text" class="form-control" id="berat" required placeholder="Contoh: 10 gram" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Kadar</label>
                  <input type="text" class="form-control" id="kadar" required placeholder="Contoh: 24K, 22K" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Harga</label>
                  <input type="number" class="form-control" id="harga" required placeholder="0" min="0" />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="button" class="btn btn-primary" id="btnTambah" onclick="handleTambah()">
              <i class="bi bi-save"></i>
              Simpan Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Edit Data -->
    <div class="modal fade" id="modalEdit" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header p-2 bg-primary">
            <h5 class="modal-title">
              <i class="bi bi-pencil-square"></i>
              Edit Data
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="formEdit">
              <input type="hidden" id="editRowIndex" />
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label required">Tanggal</label>
                  <input type="date" class="form-control" id="editTanggal" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Jam</label>
                  <input type="time" class="form-control" id="editJam" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Sales</label>
                  <input type="text" class="form-control" id="editSales" required placeholder="Nama sales" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Nama Customer</label>
                  <input type="text" class="form-control" id="editNamaCustomer" placeholder="Nama customer" />
                </div>
                <div class="col-12">
                  <label class="form-label">Info Kontak</label>
                  <input type="text" class="form-control" id="editInfoKontak" placeholder="No. HP / Email" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Nama Barang</label>
                  <input type="text" class="form-control" id="editNamaBarang" required placeholder="Nama barang" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Berat</label>
                  <input type="text" class="form-control" id="editBerat" required placeholder="Contoh: 10 gram" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Kadar</label>
                  <input type="text" class="form-control" id="editKadar" required placeholder="Contoh: 24K, 22K" />
                </div>
                <div class="col-md-6">
                  <label class="form-label required">Harga</label>
                  <input type="number" class="form-control" id="editHarga" required placeholder="0" min="0" />
                </div>
              </div>
              <div class="alert alert-info mt-3 mb-0">
                <i class="bi bi-info-circle"></i>
                Foto tidak akan berubah. Untuk ubah foto, gunakan tombol Upload/Hapus di tabel.
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="button" class="btn btn-primary" id="btnEdit" onclick="handleEdit()">
              <i class="bi bi-check-circle"></i>
              Update Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="notification" class="notification"></div>

    <?!= include('dashboard-script'); ?>
  </body>
</html>
